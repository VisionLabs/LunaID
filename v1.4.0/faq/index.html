
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://visionlabs.github.io/LunaID/latest/v1.4.0/faq/">
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../changelog/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.11">
    
    
      
        <title>FAQ - LunaID</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.85bb2934.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#aar" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="LunaID" class="md-header__button md-logo" aria-label="LunaID" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LunaID
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              FAQ
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/VisionLabs/LunaID/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="LunaID" class="md-nav__button md-logo" aria-label="LunaID" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    LunaID
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/VisionLabs/LunaID/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          FAQ
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        FAQ
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#aar" class="md-nav__link">
    как добавить в зависимость aar
  </a>
  
    <nav class="md-nav" aria-label="как добавить в зависимость aar">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#repositories" class="md-nav__link">
    добавить репозиторий в repositories:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    настройте логин и пароль для скачивания
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#buildgradle" class="md-nav__link">
    добавить зависимость в build.gradle
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#luna-id-sdk" class="md-nav__link">
    как инициализировать Luna ID SDK
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    как добавить оверлей в камеру
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    как сделать оверлей статический
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    как получать ошибки распознавания лица
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    как сделать оверлей с динамической рамкой лица
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cameraoverlaydelegate" class="md-nav__link">
    CameraOverlayDelegate и динамическая типизация через словари
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mobilesdk" class="md-nav__link">
    как добавить лицензию mobileSDK
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mobilesdk_1" class="md-nav__link">
    как перезаписать настройки mobileSDK
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    как изменить настройки распознавания
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#plan-" class="md-nav__link">
    как уменьшить размер приложения, исключив лишние .plan-файлы
  </a>
  
    <nav class="md-nav" aria-label="как уменьшить размер приложения, исключив лишние .plan-файлы">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#buildgradlekts" class="md-nav__link">
    build.gradle.kts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#buildgradle_1" class="md-nav__link">
    build.gradle
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#luna-id-sdk_1" class="md-nav__link">
    как замерить размер, который добавляет Luna ID SDK к вашему приложению
  </a>
  
    <nav class="md-nav" aria-label="как замерить размер, который добавляет Luna ID SDK к вашему приложению">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#buildgradlekts_1" class="md-nav__link">
    build.gradle.kts:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#buildgradle_2" class="md-nav__link">
    build.gradle
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    как включить дескрипторы
  </a>
  
    <nav class="md-nav" aria-label="как включить дескрипторы">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    Как использовать интеракцию
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#platform-api" class="md-nav__link">
    Как пользоваться интерфейсом в Platform API
  </a>
  
    <nav class="md-nav" aria-label="Как пользоваться интерфейсом в Platform API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    инициализация
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    добавление статических заголовков
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    добавление динамических заголовков
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    использование
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    Как пользоваться камерой для получения бестшота
  </a>
  
    <nav class="md-nav" aria-label="Как пользоваться камерой для получения бестшота">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    как использовать проверку на лайфнесс во время получения бестшота
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    как записывать видео сессии получения бестшота
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../changelog/" class="md-nav__link">
        Changelog
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#aar" class="md-nav__link">
    как добавить в зависимость aar
  </a>
  
    <nav class="md-nav" aria-label="как добавить в зависимость aar">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#repositories" class="md-nav__link">
    добавить репозиторий в repositories:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    настройте логин и пароль для скачивания
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#buildgradle" class="md-nav__link">
    добавить зависимость в build.gradle
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#luna-id-sdk" class="md-nav__link">
    как инициализировать Luna ID SDK
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    как добавить оверлей в камеру
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    как сделать оверлей статический
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    как получать ошибки распознавания лица
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    как сделать оверлей с динамической рамкой лица
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cameraoverlaydelegate" class="md-nav__link">
    CameraOverlayDelegate и динамическая типизация через словари
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mobilesdk" class="md-nav__link">
    как добавить лицензию mobileSDK
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mobilesdk_1" class="md-nav__link">
    как перезаписать настройки mobileSDK
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    как изменить настройки распознавания
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#plan-" class="md-nav__link">
    как уменьшить размер приложения, исключив лишние .plan-файлы
  </a>
  
    <nav class="md-nav" aria-label="как уменьшить размер приложения, исключив лишние .plan-файлы">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#buildgradlekts" class="md-nav__link">
    build.gradle.kts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#buildgradle_1" class="md-nav__link">
    build.gradle
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#luna-id-sdk_1" class="md-nav__link">
    как замерить размер, который добавляет Luna ID SDK к вашему приложению
  </a>
  
    <nav class="md-nav" aria-label="как замерить размер, который добавляет Luna ID SDK к вашему приложению">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#buildgradlekts_1" class="md-nav__link">
    build.gradle.kts:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#buildgradle_2" class="md-nav__link">
    build.gradle
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    как включить дескрипторы
  </a>
  
    <nav class="md-nav" aria-label="как включить дескрипторы">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    Как использовать интеракцию
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#platform-api" class="md-nav__link">
    Как пользоваться интерфейсом в Platform API
  </a>
  
    <nav class="md-nav" aria-label="Как пользоваться интерфейсом в Platform API">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    инициализация
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    добавление статических заголовков
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    добавление динамических заголовков
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    использование
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    Как пользоваться камерой для получения бестшота
  </a>
  
    <nav class="md-nav" aria-label="Как пользоваться камерой для получения бестшота">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    как использовать проверку на лайфнесс во время получения бестшота
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    как записывать видео сессии получения бестшота
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>FAQ</h1>

<h4 id="aar">как добавить в зависимость aar</h4>
<p>Пример ниже описанного можно посмотреть в <code>CameraExample</code>.</p>
<h5 id="repositories">добавить репозиторий в <code>repositories</code>:</h5>
<pre><code class="language-kotlin">    repositories {
        ...

        ivy {
            url = java.net.URI.create(&quot;https://download.visionlabs.ru/&quot;)
            patternLayout {
                artifact (&quot;[organisation]/[artifact]-[revision].[ext]&quot;)
                setM2compatible(false)
            }
            credentials {
                username = getLocalProperty(&quot;vl.login&quot;) as String
                password = getLocalProperty(&quot;vl.pass&quot;) as String
            }
            metadataSources { artifact() }
        }
    }
</code></pre>
<h5 id="_1">настройте логин и пароль для скачивания</h5>
<p>Файлы с <code>https://download.visionlabs.ru/</code> можно скачивать только с аутентификацией.<br />
Сохраните логин и пароль в файле <code>local.properties</code>:</p>
<pre><code class="language-shell">vl.login=YOUR_LOGIN
vl.pass=YOUR_PASSWORD
</code></pre>
<p>и добавьте функцию для получения логина и пароля в удобное место.</p>
<pre><code class="language-kotlin">fun getLocalProperty(key: String, file: String = &quot;local.properties&quot;): Any {
    val properties = java.util.Properties()
    val localProperties = File(file)
    if (localProperties.isFile) {
        java.io.InputStreamReader(java.io.FileInputStream(localProperties), Charsets.UTF_8).use { reader -&gt;
            properties.load(reader)
        }
    } else error(&quot;File from not found: '$file'&quot;)

    if (!properties.containsKey(key)) {
        error(&quot;Key not found '$key' in file '$file'&quot;)
    }
    return properties.getProperty(key)
}
</code></pre>
<p>Примечание: файл <code>local.properties</code> принято добавлять в <code>.gitignore</code>, чтобы он не попал в систему контроля версий.</p>
<h5 id="buildgradle">добавить зависимость в build.gradle</h5>
<pre><code class="language-kotlin">dependencies {
    ...

    implementation(&quot;ai.visionlabs.lunaid:core:{VERSION}@aar&quot;)
}
</code></pre>
<p>Пример: <code>implementation("ai.visionlabs.lunaid:core:1.2.3@aar")</code>.</p>
<h4 id="luna-id-sdk">как инициализировать Luna ID SDK</h4>
<p>см. App</p>
<h4 id="_2">как добавить оверлей в камеру</h4>
<p>добавить в свое приложение лейаут с именем vl_lunacamera_overlay.<br />
в нем может быть что угодно. например, фрагмент.<br />
см. OverlayFragment</p>
<h4 id="_3">как сделать оверлей статический</h4>
<p>см. OverlayFragment + ViewportView</p>
<h4 id="_4">как получать ошибки распознавания лица</h4>
<p>см. CameraOverlayDelegate и в нем подписку на события из камеры.</p>
<h4 id="_5">как сделать оверлей с динамической рамкой лица</h4>
<p>см. OverlayFragment + FaceDetectionView + CameraOverlayDelegate</p>
<h4 id="cameraoverlaydelegate">CameraOverlayDelegate и динамическая типизация через словари</h4>
<p>события из камеры приходят через CameraOverlayDelegate в словарях.<br />
какие структуры могут прийтий в словарях - см. OverlayFragment.  </p>
<h4 id="mobilesdk">как добавить лицензию mobileSDK</h4>
<p>в своем приложении положить файл лицензии по пути src/main/assets/data/license.conf.  </p>
<h3 id="mobilesdk_1">как перезаписать настройки mobileSDK</h3>
<p>положить соответствующие файлы настроек по пути src/main/assets/data/.  </p>
<h3 id="_6">как изменить настройки распознавания</h3>
<p>В LunaCore.aar используются настройки детекции по умолчанию.<br />
Эти настройки хранятся в .conf файлах, которые лежат внутри LunaCore.aar и напрямую их изменить нельзя.<br />
Однако их можно изменить, если положить одноименные файлы в своем приложении по пути <code>assets/data</code>.<br />
Например, чтобы если нужно поменять настройки FaceEngine, тогда внутри вашего приложения, куда подключается LunaCore.aar как зависимость, нужно создать файл <code>assests/data/faceengine.conf</code>, в котором будут прописаны все настройки FaceEngine.<br />
Для списка доступных настроек обратитесь к документации mobileSDK.<br />
Важно, чтобы ваш <code>faceengine.conf</code> содержал все настройки, а не только те, которые вы хотите изменить, потому что ваш файл полностью перезапишет все настройки, которые содержатся в LunaCore.aar, а не дополнит их.</p>
<h3 id="plan-">как уменьшить размер приложения, исключив лишние .plan-файлы</h3>
<h4 id="buildgradlekts">build.gradle.kts</h4>
<pre><code class="language-kotlin">android {
    ...

    androidResources {
        ignoreAssetsPatterns.addAll(
            listOf(
                &quot;!glasses_estimation_flwr_arm.plan&quot;,
                &quot;!glasses_estimation_flwr_cpu.plan&quot;,
                &quot;!mask_clf_v3_arm.plan&quot;,
                &quot;!mask_clf_v3_cpu.plan&quot;,
                &quot;!oslm_v4_model_1_arm.plan&quot;,
                &quot;!oslm_v4_model_1_cpu.plan&quot;,
                &quot;!oslm_v4_model_2_arm.plan&quot;,
                &quot;!oslm_v4_model_2_cpu.plan&quot;,
                &quot;!cnn59m_arm.plan&quot;,
                &quot;!cnn59m_cpu.plan&quot;,
                &quot;!cnndescriptor_59.conf&quot;,
            )
        )
    }

    ...
}
</code></pre>
<h4 id="buildgradle_1">build.gradle</h4>
<pre><code class="language-kotlin">android {
    ...

    androidResources {
        ignoreAssetsPatterns.addAll(
                [
                        &quot;!glasses_estimation_flwr_arm.plan&quot;,
                        &quot;!glasses_estimation_flwr_cpu.plan&quot;,
                        &quot;!mask_clf_v3_arm.plan&quot;,
                        &quot;!mask_clf_v3_cpu.plan&quot;,
                        &quot;!oslm_v4_model_1_arm.plan&quot;,
                        &quot;!oslm_v4_model_1_cpu.plan&quot;,
                        &quot;!oslm_v4_model_2_arm.plan&quot;,
                        &quot;!oslm_v4_model_2_cpu.plan&quot;,
                        &quot;!cnn59m_arm.plan&quot;,
                        &quot;!cnn59m_cpu.plan&quot;,
                        &quot;!cnndescriptor_59.conf&quot;,
                ]
        )
    }

    ...
}
</code></pre>
<p>Примечание: для AGP версии 7.1 или ниже <code>androidResources</code> замените на <code>AaptOptions</code>.</p>
<h3 id="luna-id-sdk_1">как замерить размер, который добавляет Luna ID SDK к вашему приложению</h3>
<p>Обновить файлы сборки, чтобы собирались отдельные .apk файлы под разные платформы.  </p>
<h4 id="buildgradlekts_1">build.gradle.kts:</h4>
<pre><code class="language-kotlin">android {
    ...

    splits {
        abi {
            isEnable = true
            reset()
            include(&quot;armeabi-v7a&quot;, &quot;arm64-v8a&quot;, &quot;x86&quot;, &quot;x86_64&quot;)
            isUniversalApk = false
        }
    }

    ...
}
</code></pre>
<h4 id="buildgradle_2">build.gradle</h4>
<pre><code class="language-groovy">android {
    ...

    splits {
        abi {
            enable true
            reset()
            include &quot;armeabi-v7a&quot;, &quot;arm64-v8a&quot;, &quot;x86&quot;, &quot;x86_64&quot;
            universalApk false
        }
    }

    ...
}
</code></pre>
<p>В Android Studio запустить утилиту <code>Analyze APK</code>.<br />
В ней открыть собранный .apk файл конкретной платформы (например, <code>armeabi-v7a</code>).<br />
И посмотреть, сколько занимают следующие файлы:</p>
<ul>
<li>папка assets/data</li>
<li>lib/{platform}/libTrackEngineSDK.so</li>
<li>lib/{platform}/libBestShotMobile.so</li>
<li>lib/{platform}/libflower.so</li>
<li>lib/{platform}/libMatchingKernel.s</li>
<li>lib/{platform}/libFaceEngineSDK.so</li>
<li>lib/{platform}/libwrapper.so</li>
<li>lib/{platform}/libc++_shared.so</li>
</ul>
<p>Любые другие файлы не относятся к Luna ID SDK и добавляются другими зависимостями вашего приложения.  </p>
<p>Обратите внимание: в утилите <code>Analyze APK</code> в папке <code>lib</code> должна быть только одна платформа (&ldquo;armeabi-v7a&rdquo;, &ldquo;arm64-v8a&rdquo; или другая). Если в этой папке больше одной платформы, значит вы смотрите универсальный .apk файл, который включает все платформы. Вернитесь на шаг назад и пересоберите приложение с включенным <code>splits.abi</code>.  </p>
<h4 id="_7">как включить дескрипторы</h4>
<p>Обратите внимание: для генерации дескрипторов в конечное приложение добавятся дополнительные файлы, поэтому размер приложения увеличится.</p>
<h5 id="_8"></h5>
<p>Убрать из игнорируемых файлов <code>cnn</code> файлы.</p>
<pre><code class="language-kotlin">android {
    ...

    androidResources {
        ignoreAssetsPatterns.addAll(
                [
                        &quot;!glasses_estimation_flwr_arm.plan&quot;,
                        &quot;!glasses_estimation_flwr_cpu.plan&quot;,
                        &quot;!mask_clf_v3_arm.plan&quot;,
                        &quot;!mask_clf_v3_cpu.plan&quot;,
                        &quot;!oslm_v4_model_1_arm.plan&quot;,
                        &quot;!oslm_v4_model_1_cpu.plan&quot;,
                        &quot;!oslm_v4_model_2_arm.plan&quot;,
                        &quot;!oslm_v4_model_2_cpu.plan&quot;,
                ]
        )
    }

    ...
}
</code></pre>
<h5 id="_9"></h5>
<p>При инициализации <code>LunaID</code> выставить <code>areDescriptorsEnabled = true</code>.</p>
<pre><code class="language-kotlin">        LunaID.init(
            app = this@App,
            lunaConfig = LunaConfig.create(),
            areDescriptorsEnabled = true,
        )
</code></pre>
<h5 id="_10"></h5>
<p>Чтобы получить или сравнить дескрипторы воспользоваться методами из <code>LunaUtils</code> </p>
<ul>
<li>getDescriptor(image)</li>
<li>getDescriptorFromWrapped(image)</li>
<li>matchDescriptors(first, second)</li>
</ul>
<h4 id="_11">Как использовать интеракцию</h4>
<p>Для кейса, когда от пользователя требуется выполнить действие во время съемки, мы поддерживаем моргание.<br />
За интеракцию отвечают два параметра в <code>LunaCongig</code>.<br />
<code>interactionEnabled</code> - включает или выключает интеракцию во время съемки.<br />
<code>interactionTimeout</code> - как долго (в миллисекундах) камера будет ожидать выполнения действия от пользователя прежде, чем вернуть ошибку.  </p>
<p>Пример:  </p>
<pre><code class="language-kotlin">        LunaID.init(
            this,
            LunaConfig.create(
                interactionEnabled = true,
                interactionTimeout = 10_000,
            )
        )
</code></pre>
<p>Если интеракция включена (<code>interactionEnabled = true</code>), то спустя <code>interactionTimeout</code> в <code>CameraUIDelegate#onError()</code> прилетит ошибка <code>InteractionTimeout</code>.  </p>
<h4 id="platform-api">Как пользоваться интерфейсом в Platform API</h4>
<p>В состав <code>Luna ID SDK</code> входит класс для совершения вызовов к ендпоинтам <a href="https://docs.visionlabs.ai/luna/v.5.28.0/ReferenceManuals/APIReferenceManual.html">Platform API</a>.  </p>
<h5 id="_12">инициализация</h5>
<pre><code class="language-kotlin">        val baseUrl = &quot;http://luna-platform.com/api/6/&quot;

        val apiConfig = ApiHumanConfig(
            baseUrl = baseUrl,
        )

        val platformApi = ApiHuman(apiConfig)

</code></pre>
<h5 id="_13">добавление статических заголовков</h5>
<p>Можно указать заголовки, которые будут использоваться в каждом запросе.  </p>
<pre><code class="language-kotlin">        // will be added to every request
        val constantHeaders = mapOf(
            &quot;Luna-Account-Id&quot; to &quot;12ed7399-f779-479c-8258-bbc45e6017af&quot;
        )

        val apiConfig = ApiHumanConfig(
            ...
            headers = constantHeaders,
        )

</code></pre>
<h5 id="_14">добавление динамических заголовков</h5>
<p>В некоторых случаях заголовки не известны в момент инициализации <code>ApiHuman</code>.<br />
Все запросы <code>ApiHuman</code> принимают в качестве параметра дополнительные опциональные заголовки, которые будет добавлены только к этому запросу.</p>
<pre><code class="language-kotlin">        val api: ApiHuman

        val photo: ByteArray

        // one-shot headers
        val dynamicHeaders = mapOf(
            &quot;X-Auth-Token&quot; to &quot;secret_token1&quot;
        )

        val request = VerifyRequest(
            verifierId =  &quot;sdfqw-123asdf-af123&quot;,
            payload = BinaryPayload.Photo(photo),
            extraHeaders = dynamicHeaders,
        )

        api.apiVerifiers(
            data = request,
            consumer = verifyResponseConsumer
        )

</code></pre>
<h5 id="_15">использование</h5>
<p>Класс <code>ApiHuman</code> предоставляет несколько методов для взаимодействия с <code>Platform API</code>.  </p>
<p><a href="https://docs.visionlabs.ai/luna/v.5.28.0/ReferenceManuals/APIReferenceManual.html#operation/generateEvents">#apiEvents</a><br />
POST-запрос <code>handlers/{handler_id}/events</code>.  </p>
<p><a href="https://docs.visionlabs.ai/luna/v.5.28.0/ReferenceManuals/APIReferenceManual.html#operation/postVerifier">#apiVerifiers</a><br />
POST-запрос на <code>handlers/{verifier_id}/verifications</code>.  </p>
<p><a href="https://docs.visionlabs.ai/luna/v.5.28.0/ReferenceManuals/APIReferenceManual.html#tag/liveness">#apiLiveness</a><br />
POST-запрос на <code>liveness</code>.  </p>
<p>Каждый из методов принимает в качестве аргумента коблек типа <code>Consumer&lt;Result&lt;T&gt;&gt;</code> для получения результата вызова.<br />
Когда колбек больше не нужен (например, при разрушении вью-модели), его нужно удалить вызовом <code>ApiHuman#removeCallback()</code>.  </p>
<p><code>ApiHuman</code> упрощает доступ к ендпоинтам <code>Platform API</code>. Под собой он использует интерфейс Retrofit-а.<br />
Если хочется большего контроля над запросами, интерфейс Retrofit-а доступен через <code>ApiHuman#retrofit</code>.  </p>
<h4 id="_16">Как пользоваться камерой для получения бестшота</h4>
<p>Чтобы получить бестшот, нужно открыть камеру вызовом <code>LunaID.showCamera(listener: CameraUIDelegate)</code>.<br />
У <code>CameraUIDelegate</code> есть два основных коблека:<br />
<code>bestShot(bestShot: BestShot)</code> - срабатывает, когда найден бестшот (экран камеры после этого закрывается).<br />
<code>canceled()</code> - срабатывает, если пользователь закрыл камеру (например, нажал Назад; экран камеры после этого закрывается).  </p>
<p>Посколько камера для получения бестшота открывается в новой Activity, необходимо особенно обратить внимание на жизненный цикл ваших компонентов. Например, ваша вызывающая Activity может быть убита, презентер или вью-модель пересозданы в то время, когда осуществляется поиск бестшота.<br />
Для этого случая предусмотрены два механизма:
* первый это метод <code>LunaID.unregisterListener(listener: CameraUIDelegate)</code>, который нужно вызвать, чтобы избежать утечек и срабатывания коблека <code>CameraUIDelegate</code> внутри неактуального контекста (разруженная вью-модель, например).<br />
* если <code>LunaID.unregisterListener(listener: CameraUIDelegate)</code> был вызван до того, как пользователь завершил работу с камерой (получил бестшот или закрыл камеру), на помощь прийдет второй механизм. Методы <code>LunaID.getLastCameraState()</code> и <code>LunaID.popLastCameraState()</code> позволяют получить последнее состояние камеры с бестшотом, если он был сделан. Каждый вызов <code>getLastCameraState()</code> возвращает одно и то же значение, у <code>popLastCameraState()</code> только первый вызов вернет значение и очистит его.  С помощью этого механизма можно получить сделанный бестшот, если пользователь вернулся на экран, который был пересоздан.</p>
<p>Для примера использования этих механизмов см. <code>examples/CameraExample</code>.  </p>
<h5 id="_17">как использовать проверку на лайфнесс во время получения бестшота</h5>
<p>Во время получения бестшота возможно автоматически осуществлять liveness-проверку полученных кадров средствами <code>Platform Web API</code>. Чтобы включить эту возможность, нужно определенным образом инициализировать <code>LunaID</code>:</p>
<pre><code class="language-kotlin">        val apiConfig = ApiHumanConfig(&quot;http://luna-platform.com/api/6/&quot;)
        LunaID.init(
            ...
            apiHumanConfig = apiConfig,
            onlineLivenessSettings = LivenessSettingsAlwaysEnabled
        )
</code></pre>
<p>Чтобы работала упомянутая выше проверка online-liveness, при инициализации необходимо указать две вещи:</p>
<p>1) <code>apiHumanConfig</code> с адресом, на котором празвернуто <code>Platform API</code>. Туда будут отправляться запросы для проверки liveness кадров. Без него невозможно будет делать проверку online-liveness.<br />
2) <code>onlineLivenessSettings</code>, который определяет, будет ли экран камеры делать проверку online-liveness.  Аргументом принимается имплементация класса <code>LivenessSettings</code>. Можно его реализовать, если нужна динамическое переключение проверки лайфнеса во время работы приложения. Если настройку менять не планируется, то в <code>LunaID SDK</code> уже включены две дефолтные имлементации этого интерфейса, которыми можно воспользоваться: <code>LivenessSettingsAlwaysEnabled</code> и <code>LivenessSettingsAlwaysDisabled</code>.</p>
<h4 id="_18">как записывать видео сессии получения бестшота</h4>
<p>Открыть камеру с ключем <code>recordVideo = true</code>  и колбеком <code>CameraUIDelegate</code>.</p>
<pre><code class="language-sh">LunaID.showCamera(
    ...
    cameraUIDelegate,
    recordVideo = true,
)
</code></pre>
<p>После завершения работы камеры в методы <code>bestShot(bestShot: BestShot, videoPath: String?)</code> и <code>canceled(videoPath: String?)</code> будет передан путь к локально сохраненному видеофайлу. В этот файл пишется весь процесс получения бестшота, от момента открытия экрана с камерой и до завершения.</p>
<p><code>Luna ID SDK</code> не управляет этими файлами, предполагается, что управление этими файлами (удалять, копировать, отправлять на сервер) является ответственностью вызывающей стороны.</p>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.top"], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.fac441b0.min.js"></script>
      
    
  </body>
</html>